---
authentik:
  global:
    env:
      - name: AUTHENTIK_SECRET_KEY
        value: $__file{/vault/secrets/secret-key}

    podAnnotations:
      vault.hashicorp.com/agent-inject: "true"
      vault.hashicorp.com/agent-inject-status: "update"
      vault.hashicorp.com/role: 'app'
      vault.hashicorp.com/agent-inject-template-secret-key: |
        {{- with secret "authentik" -}}
        {{ .Data.secret-key }}
        {{- end }}
      vault.hashicorp.com/agent-inject-template-postgresql-password: |
        {{- with secret "authentik/postgresql" -}}
        {{ .Data.password }}
        {{- end }}

    deploymentAnnotations:
      vault.hashicorp.com/agent-inject: "true"
      vault.hashicorp.com/agent-inject-status: "update"
      vault.hashicorp.com/role: 'app'
      vault.hashicorp.com/agent-inject-template-secret-key: |
        {{- with secret "authentik" -}}
        {{ .Data.secret-key }}
        {{- end }}
      vault.hashicorp.com/agent-inject-template-postgresql-password: |
        {{- with secret "authentik/postgresql" -}}
        {{ .Data.password }}
        {{- end }}

  server:
    service:
      annotations:
        vault.hashicorp.com/agent-inject: "true"
        vault.hashicorp.com/agent-inject-status: "update"
        vault.hashicorp.com/role: 'app'
        vault.hashicorp.com/agent-inject-template-secret-key: |
          {{- with secret "authentik" -}}
          {{ .Data.secret-key }}
          {{- end }}
        vault.hashicorp.com/agent-inject-template-postgresql-password: |
          {{- with secret "authentik/postgresql" -}}
          {{ .Data.password }}
          {{- end }}

  authentik:
    secret_key: $__file{/vault/secrets/secret-key} 
    error_reporting:
      enabled: false
    postgresql:
      password: $__file{/vault/secrets/postgresql-password}

  postgresql:
    enabled: true
    auth:
      password: $__file{/vault/secrets/postgresql-password}

  redis:
    enabled: true
  # worker:
